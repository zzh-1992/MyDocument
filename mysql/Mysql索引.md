# 索引
- 索引是存储引擎用于快速找到记录的一种数据结构

## 5.1.1 索引类型

### B-Tree索引
B-Tree索引(每一个叶子节点都包含指向下一个叶子节点的指针，从而方便叶子节点的范围遍历)

#### 查询类型
- 全值匹配 和索引中的所有列进行匹配

- 匹配最左前缀 只使用索引的第一列

- 匹配前缀 也可以只匹配某一列的值的开头部分

- 匹配范围值

- 只访问索引的查询(索引覆盖)

### 哈希索引
- 哈希索引(hash index)基于哈希表实现，只有精确匹配索引所有列的查询才能有效。对于每一行数据，存储引擎都会对索引列
  计算一个哈希码(hash code)，哈希码是一个较小的值，并且不同键值的行计算出来的哈希码也不一样。哈希索引将所有的哈希
  码存储在索引中，同时在哈希表中保存指向每个数据行的指针。
  
- 在Mysql中，只有Menory引擎显示支持哈希索引。这也是Memory引擎表的默认引擎，Memory引擎同时也支持B-Tree索引。

#### 哈希索引优缺点
 优点
- 索引结构紧凑，查询速度快。
  
缺点
- 哈希索引只包含哈希值和行指针，不存储字段值，所以不能使用索引中的值来避免读取行
  
- 哈希索引并不是按照索引值顺序存储，所以无法用于排序
- 哈希索引不支持部分索引列匹配查找，因为哈希索引始终使用索引列的全部内容来计算哈希值(例如，在数据（A，B）上建立哈希索引，
如果查询只有数据A，则无法使用该索引)
  
- 哈希索引只支持等值比较查询（不支持范围查询）
- 当存在哈希冲突时，存储引擎必须遍历链表中的所有指针，逐行进行比较，知道找到所有符合条件的行
- 如果哈希冲突很多的话，一些索引维护操作的代价也会很高。

### 空间数据索引(R-Tree)
- MyISAM表支持空间索引，可以用作地理数据存储。和B-Tree索引不同，这类索引无效前缀查询。空间索引会从所有维度来索引数据。

### 全文索引

## 5.2 索引优点
- 减少服务器需要扫描的数量
- 帮助服务器避免排序和临时表
- 可以将随机IO变为顺序IO

## 5.3 高性能的索引策略
### 5.3.1 独立的列
### 5.3.2 前缀索引和索引选择性
### 5.3.3 多列索引
### 5.3.4 选择合适的索引列顺序
### 5.3.5 聚簇索引
- 聚簇索引是一种数据存储方式。(InnoDB的聚簇索引实际上在同一个结构中保存来B-Tree索引和数据行)
- 聚簇索引的每一个叶子节点都包含来主键值、事务ID、用与事务和MVCC都回滚指针以及所有都剩余列。
- InnoDB的非叶子节点包含了索引列和一个指向下级节点的指针

优点：
- 把相关数据保存在一起
- 数据访问更快
- 使用覆盖索引扫描的查询可以直接使用叶节点中的主键值
缺点：
- 聚簇索引最大限度的提高了I/O密集型应用的性能，但如果数据全部都放到内存中，则访问的顺序就没有那么重要了，聚簇索引也就没有扫描
  优势了。
- 插入速度严重依赖插入顺序
- 更新聚簇索引列代价高
- 基于聚簇索引的表在插入新行，或者主键被被更新导致需要移动行的时候，可能面临"页分裂（page split）"的问题
- 聚簇索引可能导致全表扫描变慢
- 二级索引（非聚簇索引）可能比想象的要更大，因为二级索引的叶子节点包含列引用行的主键列
- 二级索引需两次索引查询，而不是一次


###5.3.6 覆盖索引
- 如果一个索引包含所有需要查询的字段的值，就将它成为覆盖索引。

- 如果只需要读取索引，那Mysql就会极大地减少数据访问量
- 因为索引是按照列值顺序存储(至少在单页内是如此)，所以对于I/O密集型的范围查询会比随机从磁盘读取一行数据的I/O要少的多。
- 如果二级主键能够覆盖查询，则可以避免对主键索引的二次查询

- 索引覆盖查询时，在EXPLAIN的extra列可以看到"Using index"
